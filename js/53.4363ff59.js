"use strict";(self["webpackChunkog_coffee"]=self["webpackChunkog_coffee"]||[]).push([[53],{9103:function(t,e,s){s.d(e,{Z:function(){return b}});var a=s(6252),i=s(9963),n=s(3577);const o={"aria-label":"Page navigation example"},r={class:"pagination justify-content-center align-items-center"},c=["disabled"],l=["onClick"],p={key:0,class:"page-item disabled mx-1"},d=(0,a._)("a",{href:"#",class:"bg-gray text-white page-link rounded-1"},"1",-1),u=[d],g=["disabled"];function h(t,e,s,d,h,y){return(0,a.wg)(),(0,a.iD)("nav",o,[(0,a._)("ul",r,[(0,a._)("li",null,[(0,a._)("button",{type:"button",class:"btn text-primary bg-transparent border-0",disabled:!s.pages.has_pre,onClick:e[0]||(e[0]=(0,i.iM)((t=>y.updatePage(s.pages.current_page-1)),["prevent"]))},[(0,a._)("i",{class:(0,n.C_)(["bi bi-chevron-double-left fs-5",{"text-white opacity-75":!s.pages.has_pre}])},null,2)],8,c)]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(y.pageAry,(t=>((0,a.wg)(),(0,a.iD)("li",{class:(0,n.C_)(["page-item mx-1",{active:t===s.pages.current_page}]),key:t+"452"},[(0,a._)("a",{class:"page-link rounded-1",href:"#",onClick:(0,i.iM)((e=>y.updatePage(t)),["prevent"])},(0,n.zw)(t),9,l)],2)))),128)),s.pages.current_page?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("li",p,u)),(0,a._)("li",null,[(0,a._)("button",{type:"button",class:"btn text-primary bg-transparent border-0",disabled:!s.pages.has_next,onClick:e[1]||(e[1]=(0,i.iM)((t=>y.updatePage(s.pages.current_page+1)),["prevent"]))},[(0,a._)("i",{class:(0,n.C_)(["bi bi-chevron-double-right fs-5",{"text-white opacity-75":!s.pages.has_next}])},null,2)],8,g)])])])}s(7658);var y={props:["pages"],methods:{updatePage(t){"search"===this.pages.category?this.$emit("searchPages",t):this.$emit("emitPages",t,this.pages.category)}},computed:{pageAry(){const t=Math.abs(9*(Math.ceil(this.pages.current_page/9)-1)+1),e=[];for(let s=t;s<this.pages.total_pages+1;s++)e.push(s);return e}}},f=s(3744);const _=(0,f.Z)(y,[["render",h]]);var b=_},1053:function(t,e,s){s.r(e),s.d(e,{default:function(){return S}});var a=s(6252),i=s(3577);const n=t=>((0,a.dD)("data-v-ffb79526"),t=t(),(0,a.Cn)(),t),o={class:"container py-5"},r=n((()=>(0,a._)("h4",{class:"mb-5 text-tertiary"},"登入取得優惠卷",-1))),c={class:"row row-cols-lg-2 row-cols-1 g-3"},l={class:"coupon position-relative"},p={class:"coupon-inner position-absolute start-0 ms-2 h-100 d-flex align-items-center"},d=n((()=>(0,a._)("i",{class:"bi bi-bag fs-3"},null,-1))),u={class:"fs-4"},g=n((()=>(0,a._)("br",null,null,-1))),h=n((()=>(0,a._)("span",{class:"text-nowrap"},"折卷",-1))),y={class:"d-flex flex-column justify-content-around align-items-start ps-2 h-100"},f={class:"text-dark"},_={class:"text-dark"},b={class:"text-dark"},m=["onClick"],k={key:0,class:"bi bi-check-lg"};function v(t,e,s,n,v,w){const C=(0,a.up)("Pagination"),$=(0,a.Q2)("date");return(0,a.wg)(),(0,a.iD)("div",o,[r,(0,a._)("div",c,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(w.coupons,(t=>((0,a.wg)(),(0,a.iD)("div",{key:t.id,class:"col d-flex justify-content-center position-relative"},[(0,a._)("div",l,[(0,a._)("div",p,[(0,a._)("div",{class:(0,i.C_)(["coupon-inner-left bg-danger h-100 px-4 px-lg-5",w.today>t.due_date?"bg-gray-dark":"bg-danger"])},[d,(0,a._)("div",null,[(0,a._)("span",u,(0,i.zw)(t.percent/10),1),g,h])],2),(0,a._)("div",y,[(0,a._)("h6",f,(0,i.zw)(t.title),1),(0,a._)("p",_,[(0,a.wy)((0,a._)("span",null,null,512),[[$,t.due_date]]),(0,a.Uk)(" 失效")]),(0,a._)("p",b,"折購碼: "+(0,i.zw)(t.code),1)])]),w.today<t.due_date?((0,a.wg)(),(0,a.iD)("button",{key:0,type:"button",class:"coupon-btn btn btn-danger position-absolute top-50 end-0 translate-middle",onClick:e=>w.takeCoupon(t)},[(0,a.Uk)(" 領取 "),-1!==v.idAry.indexOf(t.id)?((0,a.wg)(),(0,a.iD)("i",k)):(0,a.kq)("",!0)],8,m)):(0,a.kq)("",!0),(0,a._)("div",{class:(0,i.C_)(["coupon-bg position-relative",{gray:w.today>t.due_date}])},null,2)])])))),128))]),(0,a.Wm)(C,{class:"mt-4",pages:w.pagination,onEmitPages:w.getCoupons},null,8,["pages","onEmitPages"])])}s(7658);var w=s(3372),C=s(9103),$=s(6486),x=s.n($),P={components:{Pagination:C.Z},data(){return{currentPage:1,idAry:[]}},created(){this.$store.dispatch("handLoading",!0),this.checkLogin(),this.handIdAry()},methods:{async getCoupons(t=1){try{await this.$store.dispatch("Coupon/getCoupons",t),this.$store.dispatch("handLoading",!1)}catch(e){throw this.$store.dispatch("handLoading",!1),new Error(e)}},async checkLogin(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)ogCoffeeToken\s*=\s*([^;]*).*$)|^.*$/,"$1");if(t)try{await(0,w.nq)(t),this.checkSuccess=!0,this.getCoupons()}catch(e){this.$store.dispatch("fireToast",{title:"請重新登入"}),this.$store.dispatch("toPage","/coupon"),this.$router.push("/login")}else this.$store.dispatch("toPage","/coupon"),this.$store.dispatch("fireToast",{title:"請先登入"}),this.$router.push("/login")},takeCoupon:x().debounce((function(t){const e=JSON.parse(localStorage.getItem("myCoupon"));if(null===e){const e=[];this.idAry.push(t.id),e.push(t),localStorage.setItem("myCoupon",JSON.stringify(e)),this.$store.dispatch("fireToast",{title:`「${t.title}」優惠卷已領取`,style:"success"})}else{const s=e.filter((e=>e.id.includes(t.id)));0===s.length?(e.push(t),this.idAry.push(t.id),localStorage.setItem("myCoupon",JSON.stringify(e)),this.$store.dispatch("fireToast",{title:`「${t.title}」優惠卷已領取`,style:"success"})):this.$store.dispatch("fireToast",{title:`「${t.title}」優惠卷已領取過`,style:"danger"})}}),1e3),handIdAry(){const t=JSON.parse(localStorage.getItem("myCoupon"));null!==t&&t.forEach((t=>{this.idAry.push(t.id)}))}},computed:{coupons(){return this.$store.getters["Coupon/couponsData"]},today(){return Math.round((new Date).getTime()/1e3)},pagination(){return this.$store.getters["Coupon/couponPage"]}}},D=s(3744);const A=(0,D.Z)(P,[["render",v],["__scopeId","data-v-ffb79526"]]);var S=A}}]);
//# sourceMappingURL=53.4363ff59.js.map