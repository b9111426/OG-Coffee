"use strict";(self["webpackChunkog_coffee"]=self["webpackChunkog_coffee"]||[]).push([[894],{1085:function(e,t,o){o.d(t,{Z:function(){return C}});var a=o(6252),n=o(3577);const s={id:"delProductModal",ref:"modal",class:"modal scale-in-center",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},l={class:"modal-dialog modal-dialog-centered"},i={class:"modal-content border-0"},d={class:"modal-header bg-danger text-white"},p={id:"delProductModalLabel",class:"modal-title"},c={class:"modal-body"},r={class:"text-danger"},u={class:"modal-footer"},m=(0,a._)("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 取消 ",-1);function b(e,t,o,b,g,h){return(0,a.wg)(),(0,a.iD)("div",s,[(0,a._)("div",l,[(0,a._)("div",i,[(0,a._)("div",d,[(0,a._)("h5",p,[(0,a._)("span",null,"刪除"+(0,n.zw)(o.title),1)]),(0,a._)("button",{type:"button",class:"btn-close bg-gray me-1","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=(...t)=>e.handClass&&e.handClass(...t))})]),(0,a._)("div",c,[(0,a.Uk)(" 是否刪除 "),(0,a._)("strong",r,(0,n.zw)(o.item.title),1),(0,a.Uk)(" "+(0,n.zw)(o.title)+"(刪除後將無法恢復)。 ",1)]),(0,a._)("div",u,[m,(0,a._)("button",{type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=t=>e.$emit("del-item",this.item.title))}," 確認刪除 ")])])])],512)}var g=o(1339),h={props:{item:Object,title:String},mixins:[g.Z],emits:["del-item"]},_=o(3744);const w=(0,_.Z)(h,[["render",b]]);var C=w},9103:function(e,t,o){o.d(t,{Z:function(){return w}});var a=o(6252),n=o(9963),s=o(3577);const l={"aria-label":"Page navigation example"},i={class:"pagination justify-content-center align-items-center"},d=["disabled"],p=["onClick"],c={key:0,class:"page-item disabled mx-1"},r=(0,a._)("a",{href:"#",class:"bg-gray text-white page-link rounded-1"},"1",-1),u=[r],m=["disabled"];function b(e,t,o,r,b,g){return(0,a.wg)(),(0,a.iD)("nav",l,[(0,a._)("ul",i,[(0,a._)("li",null,[(0,a._)("button",{type:"button",class:"btn text-primary bg-transparent border-0",disabled:!o.pages.has_pre,onClick:t[0]||(t[0]=(0,n.iM)((e=>g.updatePage(o.pages.current_page-1)),["prevent"]))},[(0,a._)("i",{class:(0,s.C_)(["bi bi-chevron-double-left fs-5",{"text-white opacity-75":!o.pages.has_pre}])},null,2)],8,d)]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(g.pageAry,(e=>((0,a.wg)(),(0,a.iD)("li",{class:(0,s.C_)(["page-item mx-1",{active:e===o.pages.current_page}]),key:e+"452"},[(0,a._)("a",{class:"page-link rounded-1",href:"#",onClick:(0,n.iM)((t=>g.updatePage(e)),["prevent"])},(0,s.zw)(e),9,p)],2)))),128)),o.pages.current_page?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("li",c,u)),(0,a._)("li",null,[(0,a._)("button",{type:"button",class:"btn text-primary bg-transparent border-0",disabled:!o.pages.has_next,onClick:t[1]||(t[1]=(0,n.iM)((e=>g.updatePage(o.pages.current_page+1)),["prevent"]))},[(0,a._)("i",{class:(0,s.C_)(["bi bi-chevron-double-right fs-5",{"text-white opacity-75":!o.pages.has_next}])},null,2)],8,m)])])])}o(7658);var g={props:["pages"],methods:{updatePage(e){"search"===this.pages.category?this.$emit("searchPages",e):this.$emit("emitPages",e,this.pages.category)}},computed:{pageAry(){const e=Math.abs(9*(Math.ceil(this.pages.current_page/9)-1)+1),t=[];for(let o=e;o<this.pages.total_pages+1;o++)t.push(o);return t}}},h=o(3744);const _=(0,h.Z)(g,[["render",b]]);var w=_},2894:function(e,t,o){o.r(t),o.d(t,{default:function(){return Ce}});var a=o(6252),n=o(3577),s=o(9963),l=o(7923);const i={class:"container py-3"},d=(0,a._)("h2",null,"後台優惠卷",-1),p={class:"row mt-4"},c={class:"col-12 d-flex align-items-center justify-content-between mb-2 mb-lg-0"},r={class:"bg-white p-2 rounded text-dark"},u={key:0,class:"me-3 ms-auto"},m=(0,a._)("img",{class:"loading",src:l,alt:""},null,-1),b=[m],g={class:"col-12"},h={class:"card overflow-auto flex-nowrap mt-2 px-3"},_={class:"table mt-4 table-hover"},w=(0,a._)("thead",null,[(0,a._)("tr",{class:"table-light"},[(0,a._)("th",{class:"text-nowrap"},"名稱"),(0,a._)("th",{class:"text-nowrap"},"折扣百分比"),(0,a._)("th",{class:"text-nowrap"},"到期日"),(0,a._)("th",{width:"145",class:"text-center d-none d-lg-table-cell text-nowrap px-3"}," 是否啟用 "),(0,a._)("th",{width:"160",class:"text-center text-nowrap"},"編輯")])],-1),C={class:"d-none d-lg-table-cell"},y={class:"ps-4"},f={class:"form-check d-flex justify-content-start"},v=["id","onUpdate:modelValue","onChange"],x=["for"],k={key:0,class:"text-primary text-nowrap"},M={key:1,class:"text-gray-dark text-nowrap"},D={class:"btn-group"},$=["onClick"],P=(0,a._)("span",{class:"d-lg-block d-none text-nowrap"},"編輯",-1),L=(0,a._)("i",{class:"bi bi-pencil-square d-lg-none"},null,-1),N=[P,L],U=["onClick"],Z=(0,a._)("span",{class:"d-lg-block d-none text-nowrap"},"刪除",-1),z=(0,a._)("i",{class:"bi bi-x-lg d-lg-none"},null,-1),V=[Z,z],j={key:0,class:"text-center"},T=(0,a._)("td",{colspan:"5",class:"fs-3 text-gray py-4"},"文章列表已空",-1),A=[T];function S(e,t,o,l,m,P){const L=(0,a.up)("CouponModal"),Z=(0,a.up)("DelModal"),z=(0,a.up)("Pagination"),T=(0,a.Q2)("date");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",i,[d,(0,a._)("div",p,[(0,a._)("div",c,[(0,a._)("div",r,[(0,a._)("strong",null," 產品總數: "+(0,n.zw)(P.allCouponsNum),1)]),m.isLoading?((0,a.wg)(),(0,a.iD)("div",u,b)):(0,a.kq)("",!0),(0,a._)("button",{class:"btn btn-primary",type:"button",onClick:t[0]||(t[0]=e=>P.openCouponModal(!0))}," 建立新的優惠券 ")]),(0,a._)("div",g,[(0,a._)("div",h,[(0,a._)("table",_,[w,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(P.coupons,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id,class:(0,n.C_)({"text-secondary":!e.is_enabled})},[(0,a._)("td",null,(0,n.zw)(e.title),1),(0,a._)("td",null,(0,n.zw)(e.percent)+"%",1),(0,a._)("td",null,[(0,a.wy)((0,a._)("span",null,null,512),[[T,e.due_date]])]),(0,a._)("td",C,[(0,a._)("div",y,[(0,a._)("div",f,[(0,a.wy)((0,a._)("input",{class:"form-check-input me-2",type:"checkbox","true-value":1,"false-value":0,id:`couponSwitch${e.id}`,"onUpdate:modelValue":t=>e.is_enabled=t,onChange:t=>P.updateCoupon({coupon:e,isNew:!1})},null,40,v),[[s.e8,e.is_enabled]]),(0,a._)("label",{class:"form-check-label",for:`couponSwitch${e.id}`},[e.is_enabled?((0,a.wg)(),(0,a.iD)("span",k,"啟用")):((0,a.wg)(),(0,a.iD)("span",M,"未啟用"))],8,x)])])]),(0,a._)("td",null,[(0,a._)("div",D,[(0,a._)("button",{type:"button",class:"btn btn-primary btn-sm",onClick:t=>P.openCouponModal(!1,e)},N,8,$),(0,a._)("button",{type:"button",class:"btn btn-danger btn-sm",onClick:t=>P.openDelCouponModal(e)},V,8,U)])])],2)))),128))]),0===P.coupons.length?((0,a.wg)(),(0,a.iD)("tbody",j,A)):(0,a.kq)("",!0)])])])])]),(0,a.Wm)(L,{coupon:m.tempCoupon,"is-new":m.isNew,ref:"couponModal",onUpdateCoupon:P.updateCoupon},null,8,["coupon","is-new","onUpdateCoupon"]),(0,a.Wm)(Z,{item:m.tempCoupon,title:m.title,ref:"delModal",onDelItem:P.delCoupon},null,8,["item","title","onDelItem"]),(0,a.Wm)(z,{pages:P.pagination,onEmitPages:P.getCoupons,class:"mt-3 pb-5"},null,8,["pages","onEmitPages"])],64)}const q={class:"modal scale-in-center",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},E={class:"modal-dialog modal-dialog-centered text-start",role:"document"},O={class:"modal-content"},H={class:"modal-header bg-dark text-white"},I={class:"modal-title",id:"exampleModalLabel"},W={key:0},Y={key:1},K=(0,a._)("button",{type:"button",class:"btn-close bg-gray me-1","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),B={class:"modal-body"},Q={class:"mb-3"},F=(0,a._)("label",{for:"title"},"標題",-1),G={class:"mb-3"},J=(0,a._)("label",{for:"coupon_code"},"優惠碼",-1),R={class:"mb-3"},X=(0,a._)("label",{for:"due_date"},"到期日",-1),ee={class:"mb-3"},te=(0,a._)("label",{for:"price"},"折扣百分比",-1),oe={class:"mb-3"},ae={class:"form-check"},ne=(0,a._)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),se={class:"modal-footer"},le=(0,a._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ie(e,t,o,l,i,d){return(0,a.wg)(),(0,a.iD)("div",q,[(0,a._)("div",E,[(0,a._)("div",O,[(0,a._)("div",H,[(0,a._)("h5",I,[o.isNew?((0,a.wg)(),(0,a.iD)("span",W,"新增優惠卷")):((0,a.wg)(),(0,a.iD)("span",Y,"編輯優惠卷"))]),K]),(0,a._)("div",B,[(0,a._)("div",Q,[F,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=e=>i.tempCoupon.title=e),placeholder:"請輸入標題"},null,512),[[s.nr,i.tempCoupon.title]])]),(0,a._)("div",G,[J,(0,a.wy)((0,a._)("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":t[1]||(t[1]=e=>i.tempCoupon.code=e),placeholder:"請輸入優惠碼"},null,512),[[s.nr,i.tempCoupon.code]])]),(0,a._)("div",R,[X,(0,a.wy)((0,a._)("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":t[2]||(t[2]=e=>i.due_date=e)},null,512),[[s.nr,i.due_date]])]),(0,a._)("div",ee,[te,(0,a.wy)((0,a._)("input",{type:"number",class:"form-control",id:"price",min:"0","onUpdate:modelValue":t[3]||(t[3]=e=>i.tempCoupon.percent=e),placeholder:"請輸入折扣百分比"},null,512),[[s.nr,i.tempCoupon.percent,void 0,{number:!0}]])]),(0,a._)("div",oe,[(0,a._)("div",ae,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":t[4]||(t[4]=e=>i.tempCoupon.is_enabled=e),id:"is_enabled"},null,512),[[s.e8,i.tempCoupon.is_enabled]]),ne])])]),(0,a._)("div",se,[le,(0,a._)("button",{type:"button",class:"btn btn-primary",onClick:t[5]||(t[5]=t=>e.$emit("update-coupon",{coupon:i.tempCoupon,isNew:o.isNew}))},(0,n.zw)(o.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}var de=o(1339),pe={props:{coupon:{type:Object,default(){return{}}},isNew:{type:Boolean,default:!1}},data(){return{tempCoupon:{},due_date:""}},emits:["update-coupon"],watch:{coupon(){this.tempCoupon=this.coupon;const e=new Date(1e3*this.tempCoupon.due_date).toISOString().split("T");[this.due_date]=e},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}},mixins:[de.Z]},ce=o(3744);const re=(0,ce.Z)(pe,[["render",ie]]);var ue=re,me=o(1085),be=o(9103),ge=o(6486),he=o.n(ge),_e={components:{CouponModal:ue,DelModal:me.Z,Pagination:be.Z},props:{config:Object},data(){return{tempCoupon:{},isNew:!1,isLoading:!1,currentPage:1,title:"優惠卷"}},methods:{openCouponModal(e,t){this.isNew=e,this.isNew?this.tempCoupon={due_date:(new Date).getTime()/1e3}:this.tempCoupon={...t},this.$refs.couponModal.openModal()},openDelCouponModal(e){this.tempCoupon={...e};const t=this.$refs.delModal;t.openModal()},async getCoupons(e=1){try{await this.$store.dispatch("Coupon/getCoupons",e),this.getAllCoupons(),this.$store.dispatch("handLoading",!1)}catch(t){throw new Error(t)}},async getAllCoupons(){try{await this.$store.dispatch("Coupon/getAllCoupons")}catch(e){throw new Error(e)}},updateCoupon:he().debounce((async function({coupon:e,isNew:t}){this.isLoading=!0;const o=this.$refs.couponModal;try{let a=null;if(t)a=await this.$store.dispatch("Coupon/addCoupon",e);else{const t={id:e.id,coupon:e};a=await this.$store.dispatch("Coupon/modifyCoupon",t)}o.hideModal(),this.$store.dispatch("fireToast",{res:a}),this.getCoupons(this.currentPage),this.isLoading=!1}catch(a){this.isLoading=!1,this.$store.dispatch("fireToast",{res:a.response})}}),1e3),delCoupon:he().debounce((async function(e){try{this.isLoading=!0,await this.$store.dispatch("Coupon/deleteCoupon",this.tempCoupon.id);const t=this.$refs.delModal;t.hideModal(),this.getCoupons(this.currentPage),this.isLoading=!1,this.$store.dispatch("fireToast",{title:`${e}優惠卷已刪除`,style:"success"}),this.isLoading=!1}catch(t){this.$store.dispatch("fireToast",{res:t.response})}}),500)},created(){this.$store.dispatch("handLoading",!0),this.getCoupons()},computed:{coupons(){return this.$store.getters["Coupon/couponsData"]},pagination(){return this.$store.getters["Coupon/couponPage"]},allCouponsNum(){return this.$store.getters["Coupon/allCouponsNum"]}}};const we=(0,ce.Z)(_e,[["render",S]]);var Ce=we},7923:function(e,t,o){e.exports=o.p+"img/load.c8fc3381.gif"}}]);
//# sourceMappingURL=894.f88fc0bc.js.map