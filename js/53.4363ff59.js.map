{"version":3,"file":"js/53.4363ff59.js","mappings":"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","sources":["webpack://og-coffee/./src/components/Pagination.vue","webpack://og-coffee/./src/components/Pagination.vue?33dc","webpack://og-coffee/./src/views/FrontView/CouponView.vue","webpack://og-coffee/./src/views/FrontView/CouponView.vue?6de9"],"sourcesContent":["<template>\r\n  <nav aria-label=\"Page navigation example\">\r\n    <ul class=\"pagination justify-content-center align-items-center\">\r\n      <li>\r\n        <button\r\n          type=\"button\"\r\n          class=\"btn text-primary bg-transparent border-0\"\r\n          :disabled=\"!pages.has_pre\"\r\n          @click.prevent=\"updatePage(pages.current_page - 1)\"\r\n        >\r\n          <i\r\n            class=\"bi bi-chevron-double-left fs-5\"\r\n            :class=\"{\r\n              'text-white opacity-75': !pages.has_pre\r\n            }\"\r\n          ></i>\r\n        </button>\r\n      </li>\r\n      <li\r\n        class=\"page-item mx-1\"\r\n        :class=\"{ active: item === pages.current_page }\"\r\n        v-for=\"item in pageAry\"\r\n        :key=\"item + '452'\"\r\n      >\r\n        <a\r\n          class=\"page-link rounded-1\"\r\n          href=\"#\"\r\n          @click.prevent=\"updatePage(item)\"\r\n          >{{ item }}</a\r\n        >\r\n      </li>\r\n      <li v-if=\"!pages.current_page\" class=\"page-item disabled mx-1\">\r\n        <a href=\"#\" class=\"bg-gray text-white page-link rounded-1\">1</a>\r\n      </li>\r\n      <li>\r\n        <button\r\n          type=\"button\"\r\n          class=\"btn text-primary bg-transparent border-0\"\r\n          :disabled=\"!pages.has_next\"\r\n          @click.prevent=\"updatePage(pages.current_page + 1)\"\r\n        >\r\n          <i\r\n            class=\"bi bi-chevron-double-right fs-5\"\r\n            :class=\"{\r\n              'text-white opacity-75': !pages.has_next\r\n            }\"\r\n          ></i>\r\n        </button>\r\n      </li>\r\n    </ul>\r\n  </nav>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  props: ['pages'],\r\n  methods: {\r\n    updatePage(page) {\r\n      if (this.pages.category === 'search') {\r\n        this.$emit('searchPages', page)\r\n      } else {\r\n        this.$emit('emitPages', page, this.pages.category)\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    pageAry() {\r\n      const startPage = Math.abs(\r\n        (Math.ceil(this.pages.current_page / 9) - 1) * 9 + 1\r\n      )\r\n      const ary = []\r\n      for (let i = startPage; i < this.pages.total_pages + 1; i++) {\r\n        ary.push(i)\r\n      }\r\n      return ary\r\n    }\r\n  }\r\n}\r\n</script>\r\n","import { render } from \"./Pagination.vue?vue&type=template&id=2205e8aa\"\nimport script from \"./Pagination.vue?vue&type=script&lang=js\"\nexport * from \"./Pagination.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\b9111\\\\OneDrive\\\\桌面\\\\og-coffee\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__","<template>\r\n  <div class=\"container py-5\">\r\n    <h4 class=\"mb-5 text-tertiary\">登入取得優惠卷</h4>\r\n\r\n    <div class=\"row row-cols-lg-2 row-cols-1 g-3\">\r\n      <div\r\n        v-for=\"i in coupons\"\r\n        :key=\"i.id\"\r\n        class=\"col d-flex justify-content-center position-relative\"\r\n      >\r\n        <div class=\"coupon position-relative\">\r\n          <div\r\n            class=\"coupon-inner position-absolute start-0 ms-2 h-100 d-flex align-items-center\"\r\n          >\r\n            <div\r\n              class=\"coupon-inner-left bg-danger h-100 px-4 px-lg-5\"\r\n              :class=\"today > i.due_date ? 'bg-gray-dark' : 'bg-danger'\"\r\n            >\r\n              <i class=\"bi bi-bag fs-3\"></i>\r\n              <div>\r\n                <span class=\"fs-4\">{{ i.percent / 10 }}</span>\r\n                <br />\r\n                <span class=\"text-nowrap\">折卷</span>\r\n              </div>\r\n            </div>\r\n            <div\r\n              class=\"d-flex flex-column justify-content-around align-items-start ps-2 h-100\"\r\n            >\r\n              <h6 class=\"text-dark\">{{ i.title }}</h6>\r\n              <p class=\"text-dark\"><span v-date=\"i.due_date\"></span> 失效</p>\r\n              <p class=\"text-dark\">折購碼: {{ i.code }}</p>\r\n            </div>\r\n          </div>\r\n          <button\r\n            v-if=\"today < i.due_date\"\r\n            type=\"button\"\r\n            class=\"coupon-btn btn btn-danger position-absolute top-50 end-0 translate-middle\"\r\n            @click=\"takeCoupon(i)\"\r\n          >\r\n            領取\r\n            <i v-if=\"idAry.indexOf(i.id) !== -1\" class=\"bi bi-check-lg\"></i>\r\n          </button>\r\n          <div\r\n            class=\"coupon-bg position-relative\"\r\n            :class=\"{ gray: today > i.due_date }\"\r\n          ></div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 分頁 -->\r\n    <Pagination\r\n      class=\"mt-4\"\r\n      :pages=\"pagination\"\r\n      @emit-pages=\"getCoupons\"\r\n    ></Pagination>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { apiCheckRequest } from '@/api'\r\nimport Pagination from '@/components/Pagination.vue'\r\nimport _ from 'lodash'\r\n\r\nexport default {\r\n  components: { Pagination },\r\n  data() {\r\n    return {\r\n      currentPage: 1,\r\n      idAry: []\r\n    }\r\n  },\r\n  created() {\r\n    this.$store.dispatch('handLoading', true)\r\n    this.checkLogin()\r\n    this.handIdAry()\r\n  },\r\n  methods: {\r\n    async getCoupons(page = 1) {\r\n      try {\r\n        await this.$store.dispatch('Coupon/getCoupons', page)\r\n        this.$store.dispatch('handLoading', false)\r\n      } catch (err) {\r\n        this.$store.dispatch('handLoading', false)\r\n        throw new Error(err)\r\n      }\r\n    },\r\n    async checkLogin() {\r\n      const token = document.cookie.replace(\r\n        /(?:(?:^|.*;\\s*)ogCoffeeToken\\s*=\\s*([^;]*).*$)|^.*$/,\r\n        '$1'\r\n      )\r\n\r\n      if (token) {\r\n        try {\r\n          await apiCheckRequest(token)\r\n          this.checkSuccess = true\r\n          this.getCoupons()\r\n        } catch (err) {\r\n          this.$store.dispatch('fireToast', { title: '請重新登入' })\r\n          this.$store.dispatch('toPage', '/coupon')\r\n          this.$router.push('/login')\r\n        }\r\n      } else {\r\n        this.$store.dispatch('toPage', '/coupon')\r\n        this.$store.dispatch('fireToast', { title: '請先登入' })\r\n        this.$router.push('/login')\r\n      }\r\n    },\r\n    takeCoupon: _.debounce(function (item) {\r\n      const data = JSON.parse(localStorage.getItem('myCoupon'))\r\n      if (data === null) {\r\n        const obj = []\r\n        this.idAry.push(item.id)\r\n        obj.push(item)\r\n        localStorage.setItem('myCoupon', JSON.stringify(obj))\r\n        this.$store.dispatch('fireToast', {\r\n          title: `「${item.title}」優惠卷已領取`,\r\n          style: 'success'\r\n        })\r\n      } else {\r\n        const ary = data.filter((i) => {\r\n          return i.id.includes(item.id)\r\n        })\r\n        if (ary.length === 0) {\r\n          data.push(item)\r\n          this.idAry.push(item.id)\r\n          localStorage.setItem('myCoupon', JSON.stringify(data))\r\n          this.$store.dispatch('fireToast', {\r\n            title: `「${item.title}」優惠卷已領取`,\r\n            style: 'success'\r\n          })\r\n        } else {\r\n          this.$store.dispatch('fireToast', {\r\n            title: `「${item.title}」優惠卷已領取過`,\r\n            style: 'danger'\r\n          })\r\n        }\r\n      }\r\n    }, 1000),\r\n    handIdAry() {\r\n      const data = JSON.parse(localStorage.getItem('myCoupon'))\r\n      if (data !== null) {\r\n        data.forEach((i) => {\r\n          this.idAry.push(i.id)\r\n        })\r\n      }\r\n    }\r\n  },\r\n  computed: {\r\n    coupons() {\r\n      return this.$store.getters['Coupon/couponsData']\r\n    },\r\n    today() {\r\n      return Math.round(new Date().getTime() / 1000)\r\n    },\r\n    pagination() {\r\n      return this.$store.getters['Coupon/couponPage']\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '~@/assets/stylesheets/mixin';\r\n.coupon {\r\n  width: 430px;\r\n  height: 125px;\r\n  color: #fff;\r\n\r\n  @include phone() {\r\n    width: 330px;\r\n  }\r\n\r\n  &-bg {\r\n    position: relative;\r\n    width: inherit;\r\n    height: inherit;\r\n    background: radial-gradient(\r\n      transparent 0,\r\n      transparent 5px,\r\n      var(--danger) 5px\r\n    );\r\n    z-index: -2;\r\n    background-size: 15px 15px;\r\n    background-position: 11px 3px;\r\n  }\r\n\r\n  &-bg.gray {\r\n    background: radial-gradient(transparent 0, transparent 5px, #adb5bd 5px);\r\n    background-size: 15px 15px;\r\n    background-position: 11px 3px;\r\n  }\r\n\r\n  &-bg:before {\r\n    position: absolute;\r\n    left: 12px;\r\n    bottom: 0;\r\n    content: '';\r\n    width: inherit;\r\n    height: inherit;\r\n    z-index: -1;\r\n    background-color: var(--primary);\r\n    border-radius: 0 10px 10px 0;\r\n  }\r\n\r\n  &-bg.gray:before {\r\n    background-color: #ccc;\r\n  }\r\n\r\n  &-btn {\r\n    margin-right: -25px;\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./CouponView.vue?vue&type=template&id=ffb79526&scoped=true\"\nimport script from \"./CouponView.vue?vue&type=script&lang=js\"\nexport * from \"./CouponView.vue?vue&type=script&lang=js\"\n\nimport \"./CouponView.vue?vue&type=style&index=0&id=ffb79526&lang=scss&scoped=true\"\n\nimport exportComponent from \"C:\\\\Users\\\\b9111\\\\OneDrive\\\\桌面\\\\og-coffee\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-ffb79526\"]])\n\nexport default __exports__"],"names":["class","_createElementVNode","href","_hoisted_6","_createElementBlock","_hoisted_1","_hoisted_2","type","disabled","$props","has_pre","onClick","$options","current_page","_Fragment","item","active","key","_hoisted_5","has_next","props","methods","updatePage","page","this","pages","category","$emit","computed","pageAry","startPage","Math","abs","ceil","ary","i","total_pages","push","__exports__","render","_hoisted_3","id","_hoisted_4","due_date","_hoisted_7","percent","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","title","_hoisted_12","_hoisted_13","code","$data","indexOf","_hoisted_15","gray","_createVNode","_component_Pagination","onEmitPages","components","Pagination","data","currentPage","idAry","created","$store","dispatch","checkLogin","handIdAry","async","err","Error","token","document","cookie","replace","apiCheckRequest","checkSuccess","getCoupons","$router","takeCoupon","_","JSON","parse","localStorage","getItem","obj","setItem","stringify","style","filter","includes","length","forEach","coupons","getters","today","round","Date","getTime","pagination"],"sourceRoot":""}